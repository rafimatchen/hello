<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rafi's Dashboard</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a24;
      --bg-card-hover: #22222e;
      --border: #2a2a3a;
      --text-primary: #f0f0f5;
      --text-secondary: #8888a0;
      --accent-blue: #3b82f6;
      --accent-green: #22c55e;
      --accent-red: #ef4444;
      --accent-orange: #f97316;
      --accent-purple: #a855f7;
      --accent-cyan: #06b6d4;
      --accent-pink: #ec4899;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    .dashboard {
      max-width: 1600px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .header h1 {
      font-size: 1.75rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-time {
      text-align: right;
    }

    .header-time .time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2rem;
      font-weight: 500;
    }

    .header-time .date {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 1rem;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem;
      transition: all 0.2s ease;
    }

    .card:hover {
      background: var(--bg-card-hover);
      border-color: #3a3a4a;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-title .icon {
      font-size: 1rem;
    }

    .refresh-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.25rem;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .refresh-btn:hover {
      color: var(--text-primary);
      background: var(--bg-secondary);
    }

    /* Weather Cards */
    .weather-grid {
      grid-column: span 6;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .weather-card {
      text-align: center;
    }

    .weather-city {
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .weather-temp {
      font-size: 2.5rem;
      font-weight: 300;
      font-family: 'JetBrains Mono', monospace;
    }

    .weather-desc {
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-top: 0.25rem;
    }

    .weather-details {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 0.75rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Stocks */
    .stocks-card {
      grid-column: span 6;
    }

    .stock-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .stock-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: 8px;
    }

    .stock-symbol {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .stock-name {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .stock-price {
      text-align: right;
    }

    .stock-value {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 500;
    }

    .stock-change {
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .stock-change.up { color: var(--accent-green); }
    .stock-change.down { color: var(--accent-red); }

    /* News Cards */
    .news-card {
      grid-column: span 4;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .news-item {
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .news-item:hover {
      background: var(--bg-card-hover);
      transform: translateX(4px);
    }

    .news-source {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.25rem;
    }

    .news-source.politics { color: var(--accent-red); }
    .news-source.business { color: var(--accent-green); }
    .news-source.culture { color: var(--accent-purple); }
    .news-source.sports { color: var(--accent-orange); }
    .news-source.toronto { color: var(--accent-cyan); }

    .news-headline {
      font-size: 0.85rem;
      font-weight: 500;
      line-height: 1.4;
    }

    .news-time {
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-top: 0.35rem;
    }

    /* Deep Cuts Section */
    .deep-cuts-card {
      grid-column: span 4;
    }

    .deep-cut-item {
      padding: 1rem;
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1));
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 8px;
      margin-bottom: 0.75rem;
      text-decoration: none;
      color: inherit;
      display: block;
      transition: all 0.2s;
    }

    .deep-cut-item:hover {
      transform: translateX(4px);
      border-color: rgba(168, 85, 247, 0.4);
    }

    .deep-cut-item:last-child {
      margin-bottom: 0;
    }

    .deep-cut-category {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--accent-pink);
      margin-bottom: 0.5rem;
    }

    .deep-cut-title {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 0.35rem;
    }

    .deep-cut-desc {
      font-size: 0.75rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Toronto Focus */
    .toronto-card {
      grid-column: span 4;
      background: linear-gradient(135deg, var(--bg-card), rgba(59, 130, 246, 0.1));
      border-color: rgba(59, 130, 246, 0.3);
    }

    /* Sports Card */
    .sports-card {
      grid-column: span 4;
    }

    /* Ticker */
    .ticker-container {
      grid-column: span 12;
      overflow: hidden;
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 0.75rem 0;
    }

    .ticker {
      display: flex;
      animation: scroll 40s linear infinite;
      white-space: nowrap;
    }

    .ticker:hover {
      animation-play-state: paused;
    }

    .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0 2rem;
      font-size: 0.85rem;
    }

    .ticker-item .symbol {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
    }

    .ticker-item .change.up { color: var(--accent-green); }
    .ticker-item .change.down { color: var(--accent-red); }

    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* Loading state */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      color: var(--text-secondary);
    }

    .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--accent-blue);
      border-radius: 50%;
      margin-left: 0.5rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      color: var(--accent-red);
      font-size: 0.8rem;
      padding: 1rem;
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .weather-grid { grid-column: span 12; }
      .stocks-card { grid-column: span 12; }
      .sports-card { grid-column: span 6; }
      .news-card { grid-column: span 6; }
      .deep-cuts-card { grid-column: span 6; }
      .toronto-card { grid-column: span 6; }
    }

    @media (max-width: 768px) {
      .sports-card,
      .news-card,
      .deep-cuts-card,
      .toronto-card {
        grid-column: span 12;
      }
      .weather-grid {
        grid-template-columns: 1fr;
      }
      .stock-list {
        grid-template-columns: 1fr;
      }
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Scrollbar */
    .news-list::-webkit-scrollbar {
      width: 6px;
    }
    .news-list::-webkit-scrollbar-track {
      background: var(--bg-secondary);
      border-radius: 3px;
    }
    .news-list::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }
    .news-list::-webkit-scrollbar-thumb:hover {
      background: #3a3a4a;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // RSS Proxy - using rss2json
    const RSS_API = 'https://api.rss2json.com/v1/api.json?rss_url=';

    // Helper to fetch RSS
    async function fetchRSS(url) {
      const res = await fetch(RSS_API + encodeURIComponent(url));
      const data = await res.json();
      if (data.status === 'ok') return data.items;
      throw new Error('Failed to fetch RSS');
    }

    // Time ago helper
    function timeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const seconds = Math.floor((now - date) / 1000);
      if (seconds < 60) return 'just now';
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes}m ago`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}h ago`;
      const days = Math.floor(hours / 24);
      return `${days}d ago`;
    }

    // Weather Component (Real data from Open-Meteo)
    function WeatherCard({ city, lat, lon, timezone }) {
      const [weather, setWeather] = useState(null);
      const [error, setError] = useState(null);

      useEffect(() => {
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=${timezone}`)
          .then(r => r.json())
          .then(data => setWeather(data.current))
          .catch(e => setError(e.message));
      }, []);

      const getWeatherEmoji = (code) => {
        if (code === 0) return '‚òÄÔ∏è';
        if (code <= 3) return '‚õÖ';
        if (code <= 48) return 'üå´Ô∏è';
        if (code <= 67) return 'üåßÔ∏è';
        if (code <= 77) return 'üå®Ô∏è';
        if (code <= 82) return 'üåßÔ∏è';
        if (code <= 86) return '‚ùÑÔ∏è';
        if (code >= 95) return '‚õàÔ∏è';
        return 'üå§Ô∏è';
      };

      const getWeatherDesc = (code) => {
        if (code === 0) return 'Clear sky';
        if (code <= 3) return 'Partly cloudy';
        if (code <= 48) return 'Foggy';
        if (code <= 67) return 'Rainy';
        if (code <= 77) return 'Snowy';
        if (code <= 82) return 'Showers';
        if (code <= 86) return 'Snow showers';
        if (code >= 95) return 'Thunderstorm';
        return 'Cloudy';
      };

      if (error) return <div className="card weather-card"><div className="error">Weather unavailable</div></div>;
      if (!weather) return <div className="card weather-card"><div className="loading">Loading</div></div>;

      return (
        <div className="card weather-card">
          <div className="weather-city">{city}</div>
          <div style={{ fontSize: '2rem', margin: '0.5rem 0' }}>
            {getWeatherEmoji(weather.weather_code)}
          </div>
          <div className="weather-temp">{Math.round(weather.temperature_2m)}¬∞</div>
          <div className="weather-desc">{getWeatherDesc(weather.weather_code)}</div>
          <div className="weather-details">
            <span>üíß {weather.relative_humidity_2m}%</span>
            <span>üí® {Math.round(weather.wind_speed_10m)} km/h</span>
          </div>
        </div>
      );
    }

    // Generic News Component
    function NewsCard({ title, icon, feedUrls, category, limit = 6 }) {
      const [news, setNews] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      const fetchNews = useCallback(async () => {
        setLoading(true);
        try {
          const allItems = [];
          for (const feed of feedUrls) {
            try {
              const items = await fetchRSS(feed.url);
              items.forEach(item => {
                allItems.push({
                  ...item,
                  sourceName: feed.name,
                  region: feed.region || ''
                });
              });
            } catch (e) {
              console.warn(`Failed to fetch ${feed.name}:`, e);
            }
          }
          // Sort by date
          allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
          setNews(allItems.slice(0, limit));
          setError(null);
        } catch (e) {
          setError(e.message);
        }
        setLoading(false);
      }, [feedUrls, limit]);

      useEffect(() => {
        fetchNews();
        const interval = setInterval(fetchNews, 5 * 60 * 1000); // Refresh every 5 min
        return () => clearInterval(interval);
      }, [fetchNews]);

      if (error) return (
        <div className="card news-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">{icon}</span> {title}</span>
          </div>
          <div className="error">Failed to load news</div>
        </div>
      );

      return (
        <div className="card news-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">{icon}</span> {title}</span>
            <button className="refresh-btn" onClick={fetchNews} title="Refresh">üîÑ</button>
          </div>
          {loading && news.length === 0 ? (
            <div className="loading">Loading</div>
          ) : (
            <div className="news-list">
              {news.map((item, i) => (
                <a key={i} className="news-item" href={item.link} target="_blank" rel="noopener noreferrer">
                  <div className={`news-source ${category}`}>
                    {item.region && `${item.region} `}{item.sourceName}
                  </div>
                  <div className="news-headline">{item.title}</div>
                  <div className="news-time">{timeAgo(item.pubDate)}</div>
                </a>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Politics News
    function PoliticsCard() {
      const feeds = [
        { name: 'Reuters', url: 'https://www.reutersagency.com/feed/?best-topics=political-general&post_type=best', region: 'üåç' },
        { name: 'AP News', url: 'https://rsshub.app/apnews/topics/politics', region: 'üá∫üá∏' },
        { name: 'CBC Politics', url: 'https://www.cbc.ca/webfeed/rss/rss-politics', region: 'üá®üá¶' },
        { name: 'Times of Israel', url: 'https://www.timesofisrael.com/feed/', region: 'üáÆüá±' },
        { name: 'NPR Politics', url: 'https://feeds.npr.org/1014/rss.xml', region: 'üá∫üá∏' },
      ];
      return <NewsCard title="Politics" icon="üèõÔ∏è" feedUrls={feeds} category="politics" limit={7} />;
    }

    // Business News
    function BusinessCard() {
      const feeds = [
        { name: 'Reuters Business', url: 'https://www.reutersagency.com/feed/?best-topics=business-finance&post_type=best' },
        { name: 'CNBC', url: 'https://www.cnbc.com/id/100003114/device/rss/rss.html' },
        { name: 'Bloomberg', url: 'https://feeds.bloomberg.com/markets/news.rss' },
        { name: 'Financial Times', url: 'https://www.ft.com/rss/home' },
      ];
      return <NewsCard title="Business" icon="üíº" feedUrls={feeds} category="business" limit={6} />;
    }

    // Toronto / Canada News
    function TorontoCard() {
      const feeds = [
        { name: 'Toronto Star', url: 'https://www.thestar.com/search/?f=rss&t=article&c=news/gta*&l=50&s=start_time&sd=desc' },
        { name: 'Globe & Mail', url: 'https://www.theglobeandmail.com/arc/outboundfeeds/rss/category/canada/' },
        { name: 'CBC Toronto', url: 'https://www.cbc.ca/webfeed/rss/rss-canada-toronto', region: 'üá®üá¶' },
        { name: 'BlogTO', url: 'https://www.blogto.com/feed/' },
      ];
      return (
        <div className="toronto-card card news-card" style={{ background: 'linear-gradient(135deg, var(--bg-card), rgba(59, 130, 246, 0.1))', borderColor: 'rgba(59, 130, 246, 0.3)' }}>
          <div className="card-header">
            <span className="card-title"><span className="icon">üçÅ</span> Toronto & Canada</span>
          </div>
          <NewsCardInner feedUrls={feeds} category="toronto" limit={6} />
        </div>
      );
    }

    // Sports News
    function SportsCard() {
      const feeds = [
        { name: 'ESPN', url: 'https://www.espn.com/espn/rss/news' },
        { name: 'TSN', url: 'https://www.tsn.ca/rss/sports' },
        { name: 'Sportsnet', url: 'https://www.sportsnet.ca/feed/' },
        { name: 'The Athletic', url: 'https://theathletic.com/rss/' },
        { name: 'BBC Sport', url: 'https://feeds.bbci.co.uk/sport/rss.xml' },
      ];
      return <NewsCard title="Sports" icon="üèÜ" feedUrls={feeds} category="sports" limit={8} />;
    }

    // Culture / Arts
    function CultureCard() {
      const feeds = [
        { name: 'Pitchfork', url: 'https://pitchfork.com/feed/feed-news/rss' },
        { name: 'NYT Arts', url: 'https://rss.nytimes.com/services/xml/rss/nyt/Arts.xml' },
        { name: 'The Guardian Culture', url: 'https://www.theguardian.com/culture/rss' },
        { name: 'Hyperallergic', url: 'https://hyperallergic.com/feed/' },
      ];
      return <NewsCard title="Culture" icon="üé®" feedUrls={feeds} category="culture" limit={6} />;
    }

    // Deep Cuts - Intellectual
    function DeepCutsCard() {
      const [items, setItems] = useState([]);
      const [loading, setLoading] = useState(true);

      const feeds = [
        { name: 'Aeon', url: 'https://aeon.co/feed.rss', category: 'Philosophy' },
        { name: 'The MIT Press Reader', url: 'https://thereader.mitpress.mit.edu/feed/', category: 'Ideas' },
        { name: 'LitHub', url: 'https://lithub.com/feed/', category: 'Literature' },
        { name: 'The Marginalian', url: 'https://www.themarginalian.org/feed/', category: 'Culture' },
        { name: 'Longreads', url: 'https://longreads.com/feed/', category: 'Essays' },
        { name: 'n+1', url: 'https://www.nplusonemag.com/feed/', category: 'Criticism' },
      ];

      useEffect(() => {
        async function load() {
          const allItems = [];
          for (const feed of feeds) {
            try {
              const rssItems = await fetchRSS(feed.url);
              rssItems.slice(0, 2).forEach(item => {
                allItems.push({
                  ...item,
                  category: feed.category,
                  source: feed.name
                });
              });
            } catch (e) {
              console.warn(`Failed: ${feed.name}`);
            }
          }
          // Shuffle for variety
          allItems.sort(() => Math.random() - 0.5);
          setItems(allItems.slice(0, 5));
          setLoading(false);
        }
        load();
      }, []);

      // Strip HTML from description
      const stripHtml = (html) => {
        const tmp = document.createElement('div');
        tmp.innerHTML = html;
        return tmp.textContent || tmp.innerText || '';
      };

      return (
        <div className="card deep-cuts-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">üé≠</span> Deep Cuts</span>
          </div>
          {loading ? (
            <div className="loading">Loading</div>
          ) : (
            items.map((item, i) => (
              <a key={i} className="deep-cut-item" href={item.link} target="_blank" rel="noopener noreferrer">
                <div className="deep-cut-category">{item.category} ¬∑ {item.source}</div>
                <div className="deep-cut-title">{item.title}</div>
                <div className="deep-cut-desc">{stripHtml(item.description).slice(0, 120)}...</div>
              </a>
            ))
          )}
        </div>
      );
    }

    // Inner news component for Toronto card
    function NewsCardInner({ feedUrls, category, limit = 6 }) {
      const [news, setNews] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function load() {
          const allItems = [];
          for (const feed of feedUrls) {
            try {
              const items = await fetchRSS(feed.url);
              items.forEach(item => {
                allItems.push({ ...item, sourceName: feed.name, region: feed.region || '' });
              });
            } catch (e) {
              console.warn(`Failed: ${feed.name}`);
            }
          }
          allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
          setNews(allItems.slice(0, limit));
          setLoading(false);
        }
        load();
      }, []);

      if (loading) return <div className="loading">Loading</div>;

      return (
        <div className="news-list">
          {news.map((item, i) => (
            <a key={i} className="news-item" href={item.link} target="_blank" rel="noopener noreferrer">
              <div className={`news-source ${category}`}>
                {item.region && `${item.region} `}{item.sourceName}
              </div>
              <div className="news-headline">{item.title}</div>
              <div className="news-time">{timeAgo(item.pubDate)}</div>
            </a>
          ))}
        </div>
      );
    }

    // Stock data from Yahoo Finance via a CORS proxy
    function StocksCard() {
      const [stocks, setStocks] = useState([]);
      const [loading, setLoading] = useState(true);

      const symbols = ['SPY', 'QQQ', 'AAPL', 'MSFT', 'GOOGL', 'NVDA', 'TD.TO', 'BTC-USD'];
      const names = {
        'SPY': 'S&P 500',
        'QQQ': 'Nasdaq 100',
        'AAPL': 'Apple',
        'MSFT': 'Microsoft',
        'GOOGL': 'Alphabet',
        'NVDA': 'NVIDIA',
        'TD.TO': 'TD Bank',
        'BTC-USD': 'Bitcoin'
      };

      useEffect(() => {
        async function fetchStocks() {
          try {
            // Using Yahoo Finance via a public API
            const symbolList = symbols.join(',');
            const res = await fetch(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbolList}`);
            const data = await res.json();

            if (data.quoteResponse && data.quoteResponse.result) {
              const results = data.quoteResponse.result.map(q => ({
                symbol: q.symbol.replace('.TO', '').replace('-USD', ''),
                name: names[q.symbol] || q.shortName,
                price: q.regularMarketPrice?.toFixed(2) || 'N/A',
                change: q.regularMarketChangePercent?.toFixed(2) || 0
              }));
              setStocks(results);
            }
          } catch (e) {
            console.error('Stock fetch failed:', e);
            // Fallback to placeholder
            setStocks(symbols.map(s => ({
              symbol: s.replace('.TO', '').replace('-USD', ''),
              name: names[s],
              price: '---',
              change: 0
            })));
          }
          setLoading(false);
        }
        fetchStocks();
        const interval = setInterval(fetchStocks, 60000); // Refresh every minute
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="card stocks-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">üìà</span> Markets</span>
            <a href="https://finance.yahoo.com" target="_blank" rel="noopener noreferrer" className="refresh-btn" title="Open Yahoo Finance">‚Üó</a>
          </div>
          {loading ? (
            <div className="loading">Loading</div>
          ) : (
            <div className="stock-list">
              {stocks.map(stock => (
                <div key={stock.symbol} className="stock-item">
                  <div>
                    <div className="stock-symbol">{stock.symbol}</div>
                    <div className="stock-name">{stock.name}</div>
                  </div>
                  <div className="stock-price">
                    <div className="stock-value">${stock.price}</div>
                    <div className={`stock-change ${parseFloat(stock.change) >= 0 ? 'up' : 'down'}`}>
                      {parseFloat(stock.change) >= 0 ? '‚ñ≤' : '‚ñº'} {Math.abs(stock.change)}%
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Stock Ticker Bar
    function TickerBar() {
      const [items, setItems] = useState([]);

      const symbols = ['SPY', 'QQQ', 'DIA', 'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'TSLA', 'META', 'BTC-USD', 'ETH-USD', 'SHOP.TO', 'TD.TO', 'RY.TO'];

      useEffect(() => {
        async function fetch() {
          try {
            const res = await window.fetch(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbols.join(',')}`);
            const data = await res.json();
            if (data.quoteResponse?.result) {
              setItems(data.quoteResponse.result.map(q => ({
                symbol: q.symbol.replace('.TO', '').replace('-USD', ''),
                price: q.regularMarketPrice?.toFixed(2) || '---',
                change: q.regularMarketChangePercent?.toFixed(2) || 0
              })));
            }
          } catch (e) {
            // Fallback
            setItems(symbols.map(s => ({ symbol: s.replace('.TO', '').replace('-USD', ''), price: '---', change: 0 })));
          }
        }
        fetch();
      }, []);

      const doubled = [...items, ...items];

      return (
        <div className="ticker-container">
          <div className="ticker">
            {doubled.map((item, i) => (
              <span key={i} className="ticker-item">
                <span className="symbol">{item.symbol}</span>
                <span>${item.price}</span>
                <span className={`change ${parseFloat(item.change) >= 0 ? 'up' : 'down'}`}>
                  {parseFloat(item.change) >= 0 ? '‚ñ≤' : '‚ñº'} {Math.abs(item.change)}%
                </span>
              </span>
            ))}
          </div>
        </div>
      );
    }

    // Main App
    function App() {
      const [time, setTime] = useState(new Date());

      useEffect(() => {
        const timer = setInterval(() => setTime(new Date()), 1000);
        return () => clearInterval(timer);
      }, []);

      const formatDate = (d) => d.toLocaleDateString('en-US', {
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
      });

      const greeting = time.getHours() < 12 ? 'morning' : time.getHours() < 18 ? 'afternoon' : 'evening';

      return (
        <div className="dashboard">
          <header className="header">
            <h1>Good {greeting}, Rafi</h1>
            <div className="header-time">
              <div className="time">
                {time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
              </div>
              <div className="date">{formatDate(time)}</div>
            </div>
          </header>

          <div className="grid">
            <TickerBar />

            <div className="weather-grid">
              <WeatherCard city="New York" lat={40.7128} lon={-74.006} timezone="America/New_York" />
              <WeatherCard city="Toronto" lat={43.6532} lon={-79.3832} timezone="America/Toronto" />
              <WeatherCard city="Tel Aviv" lat={32.0853} lon={34.7818} timezone="Asia/Jerusalem" />
            </div>

            <StocksCard />

            <SportsCard />
            <TorontoCard />
            <PoliticsCard />
            <BusinessCard />
            <CultureCard />
            <DeepCutsCard />
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
