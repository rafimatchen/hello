<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rafi's Dashboard</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #1a1a24;
      --bg-card-hover: #22222e;
      --border: #2a2a3a;
      --text-primary: #f0f0f5;
      --text-secondary: #8888a0;
      --accent-blue: #3b82f6;
      --accent-green: #22c55e;
      --accent-red: #ef4444;
      --accent-orange: #f97316;
      --accent-purple: #a855f7;
      --accent-cyan: #06b6d4;
      --accent-pink: #ec4899;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    .dashboard {
      max-width: 1600px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .header h1 {
      font-size: 1.75rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-time {
      text-align: right;
    }

    .header-time .time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2rem;
      font-weight: 500;
    }

    .header-time .date {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 1rem;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem;
      transition: all 0.2s ease;
    }

    .card:hover {
      background: var(--bg-card-hover);
      border-color: #3a3a4a;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .card-title {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-title .icon {
      font-size: 1rem;
    }

    .refresh-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.25rem;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .refresh-btn:hover {
      color: var(--text-primary);
      background: var(--bg-secondary);
    }

    /* Weather Cards */
    .weather-grid {
      grid-column: span 6;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .weather-card {
      text-align: center;
    }

    .weather-city {
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .weather-temp {
      font-size: 2.5rem;
      font-weight: 300;
      font-family: 'JetBrains Mono', monospace;
    }

    .weather-desc {
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-top: 0.25rem;
    }

    .weather-details {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 0.75rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Stocks */
    .stocks-card {
      grid-column: span 6;
    }

    .stock-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .stock-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: 8px;
    }

    .stock-symbol {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .stock-name {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .stock-price {
      text-align: right;
    }

    .stock-value {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 500;
    }

    .stock-change {
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .stock-change.up { color: var(--accent-green); }
    .stock-change.down { color: var(--accent-red); }

    /* News Cards */
    .news-card {
      grid-column: span 4;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .news-item {
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .news-item:hover {
      background: var(--bg-card-hover);
      transform: translateX(4px);
    }

    .news-source {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.25rem;
    }

    .news-source.politics { color: var(--accent-red); }
    .news-source.business { color: var(--accent-green); }
    .news-source.culture { color: var(--accent-purple); }
    .news-source.sports { color: var(--accent-orange); }
    .news-source.toronto { color: var(--accent-cyan); }

    .news-headline {
      font-size: 0.85rem;
      font-weight: 500;
      line-height: 1.4;
    }

    .news-time {
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-top: 0.35rem;
    }

    /* Deep Cuts Section */
    .deep-cuts-card {
      grid-column: span 4;
    }

    .deep-cut-item {
      padding: 1rem;
      background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1));
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 8px;
      margin-bottom: 0.75rem;
      text-decoration: none;
      color: inherit;
      display: block;
      transition: all 0.2s;
    }

    .deep-cut-item:hover {
      transform: translateX(4px);
      border-color: rgba(168, 85, 247, 0.4);
    }

    .deep-cut-item:last-child {
      margin-bottom: 0;
    }

    .deep-cut-category {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--accent-pink);
      margin-bottom: 0.5rem;
    }

    .deep-cut-title {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 0.35rem;
    }

    .deep-cut-desc {
      font-size: 0.75rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Toronto Focus */
    .toronto-card {
      grid-column: span 4;
      background: linear-gradient(135deg, var(--bg-card), rgba(59, 130, 246, 0.1));
      border-color: rgba(59, 130, 246, 0.3);
    }

    /* Sports Card */
    .sports-card {
      grid-column: span 4;
    }

    /* Ticker */
    .ticker-container {
      grid-column: span 12;
      overflow: hidden;
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 0.75rem 0;
    }

    .ticker {
      display: flex;
      animation: scroll 40s linear infinite;
      white-space: nowrap;
    }

    .ticker:hover {
      animation-play-state: paused;
    }

    .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0 2rem;
      font-size: 0.85rem;
    }

    .ticker-item .symbol {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
    }

    .ticker-item .change.up { color: var(--accent-green); }
    .ticker-item .change.down { color: var(--accent-red); }

    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* Loading state */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      color: var(--text-secondary);
    }

    .loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--accent-blue);
      border-radius: 50%;
      margin-left: 0.5rem;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error {
      color: var(--accent-red);
      font-size: 0.8rem;
      padding: 1rem;
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .weather-grid { grid-column: span 12; }
      .stocks-card { grid-column: span 12; }
      .sports-card { grid-column: span 6; }
      .news-card { grid-column: span 6; }
      .deep-cuts-card { grid-column: span 6; }
      .toronto-card { grid-column: span 6; }
    }

    @media (max-width: 768px) {
      .sports-card,
      .news-card,
      .deep-cuts-card,
      .toronto-card {
        grid-column: span 12;
      }
      .weather-grid {
        grid-template-columns: 1fr;
      }
      .stock-list {
        grid-template-columns: 1fr;
      }
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Scrollbar */
    .news-list::-webkit-scrollbar {
      width: 6px;
    }
    .news-list::-webkit-scrollbar-track {
      background: var(--bg-secondary);
      border-radius: 3px;
    }
    .news-list::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 3px;
    }
    .news-list::-webkit-scrollbar-thumb:hover {
      background: #3a3a4a;
    }

    /* Transit Card */
    .transit-card {
      grid-column: span 4;
      background: linear-gradient(135deg, var(--bg-card), rgba(34, 197, 94, 0.08));
      border-color: rgba(34, 197, 94, 0.3);
    }

    .transit-route {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      margin-bottom: 0.75rem;
    }

    .transit-route:last-child {
      margin-bottom: 0;
    }

    .route-badge {
      min-width: 42px;
      height: 42px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
      flex-shrink: 0;
    }

    .route-badge.subway-6 {
      background: #00933c;
      color: white;
    }

    .route-badge.bus {
      background: #0039a6;
      color: white;
      font-size: 0.7rem;
      border-radius: 6px;
      min-width: 48px;
    }

    .route-info {
      flex: 1;
      min-width: 0;
    }

    .route-name {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.15rem;
    }

    .route-destination {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .route-times {
      text-align: right;
    }

    .next-departure {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--accent-green);
    }

    .leave-by {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .leave-now {
      color: var(--accent-orange);
      font-weight: 600;
      animation: pulse 1.5s infinite;
    }

    .transit-alert {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.6rem;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      margin-top: 0.75rem;
      font-size: 0.75rem;
    }

    .transit-alert-icon {
      flex-shrink: 0;
    }

    .transit-alert-text {
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .transit-links {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .transit-link {
      flex: 1;
      padding: 0.5rem;
      background: var(--bg-secondary);
      border-radius: 6px;
      text-align: center;
      font-size: 0.7rem;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s;
    }

    .transit-link:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
    }

    .walking-info {
      font-size: 0.65rem;
      color: var(--text-secondary);
      text-align: center;
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid var(--border);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // RSS Proxy - using rss2json
    const RSS_API = 'https://api.rss2json.com/v1/api.json?rss_url=';

    // Helper to fetch RSS
    async function fetchRSS(url) {
      const res = await fetch(RSS_API + encodeURIComponent(url));
      const data = await res.json();
      if (data.status === 'ok') return data.items;
      throw new Error('Failed to fetch RSS');
    }

    // Time ago helper
    function timeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const seconds = Math.floor((now - date) / 1000);
      if (seconds < 60) return 'just now';
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes}m ago`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}h ago`;
      const days = Math.floor(hours / 24);
      return `${days}d ago`;
    }

    // Weather Component (Real data from Open-Meteo)
    function WeatherCard({ city, lat, lon, timezone }) {
      const [weather, setWeather] = useState(null);
      const [error, setError] = useState(null);

      useEffect(() => {
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&timezone=${timezone}`)
          .then(r => r.json())
          .then(data => setWeather(data.current))
          .catch(e => setError(e.message));
      }, []);

      const getWeatherEmoji = (code) => {
        if (code === 0) return '‚òÄÔ∏è';
        if (code <= 3) return '‚õÖ';
        if (code <= 48) return 'üå´Ô∏è';
        if (code <= 67) return 'üåßÔ∏è';
        if (code <= 77) return 'üå®Ô∏è';
        if (code <= 82) return 'üåßÔ∏è';
        if (code <= 86) return '‚ùÑÔ∏è';
        if (code >= 95) return '‚õàÔ∏è';
        return 'üå§Ô∏è';
      };

      const getWeatherDesc = (code) => {
        if (code === 0) return 'Clear sky';
        if (code <= 3) return 'Partly cloudy';
        if (code <= 48) return 'Foggy';
        if (code <= 67) return 'Rainy';
        if (code <= 77) return 'Snowy';
        if (code <= 82) return 'Showers';
        if (code <= 86) return 'Snow showers';
        if (code >= 95) return 'Thunderstorm';
        return 'Cloudy';
      };

      if (error) return <div className="card weather-card"><div className="error">Weather unavailable</div></div>;
      if (!weather) return <div className="card weather-card"><div className="loading">Loading</div></div>;

      return (
        <div className="card weather-card">
          <div className="weather-city">{city}</div>
          <div style={{ fontSize: '2rem', margin: '0.5rem 0' }}>
            {getWeatherEmoji(weather.weather_code)}
          </div>
          <div className="weather-temp">{Math.round(weather.temperature_2m)}¬∞</div>
          <div className="weather-desc">{getWeatherDesc(weather.weather_code)}</div>
          <div className="weather-details">
            <span>üíß {weather.relative_humidity_2m}%</span>
            <span>üí® {Math.round(weather.wind_speed_10m)} km/h</span>
          </div>
        </div>
      );
    }

    // Generic News Component
    function NewsCard({ title, icon, feedUrls, category, limit = 6 }) {
      const [news, setNews] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      const fetchNews = useCallback(async () => {
        setLoading(true);
        try {
          const allItems = [];
          for (const feed of feedUrls) {
            try {
              const items = await fetchRSS(feed.url);
              items.forEach(item => {
                allItems.push({
                  ...item,
                  sourceName: feed.name,
                  region: feed.region || ''
                });
              });
            } catch (e) {
              console.warn(`Failed to fetch ${feed.name}:`, e);
            }
          }
          // Sort by date
          allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
          setNews(allItems.slice(0, limit));
          setError(null);
        } catch (e) {
          setError(e.message);
        }
        setLoading(false);
      }, [feedUrls, limit]);

      useEffect(() => {
        fetchNews();
        const interval = setInterval(fetchNews, 5 * 60 * 1000); // Refresh every 5 min
        return () => clearInterval(interval);
      }, [fetchNews]);

      if (error) return (
        <div className="card news-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">{icon}</span> {title}</span>
          </div>
          <div className="error">Failed to load news</div>
        </div>
      );

      return (
        <div className="card news-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">{icon}</span> {title}</span>
            <button className="refresh-btn" onClick={fetchNews} title="Refresh">üîÑ</button>
          </div>
          {loading && news.length === 0 ? (
            <div className="loading">Loading</div>
          ) : (
            <div className="news-list">
              {news.map((item, i) => (
                <a key={i} className="news-item" href={item.link} target="_blank" rel="noopener noreferrer">
                  <div className={`news-source ${category}`}>
                    {item.region && `${item.region} `}{item.sourceName}
                  </div>
                  <div className="news-headline">{item.title}</div>
                  <div className="news-time">{timeAgo(item.pubDate)}</div>
                </a>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Politics News
    function PoliticsCard() {
      const feeds = [
        { name: 'Reuters', url: 'https://www.reutersagency.com/feed/?best-topics=political-general&post_type=best', region: 'üåç' },
        { name: 'AP News', url: 'https://rsshub.app/apnews/topics/politics', region: 'üá∫üá∏' },
        { name: 'CBC Politics', url: 'https://www.cbc.ca/webfeed/rss/rss-politics', region: 'üá®üá¶' },
        { name: 'Times of Israel', url: 'https://www.timesofisrael.com/feed/', region: 'üáÆüá±' },
        { name: 'NPR Politics', url: 'https://feeds.npr.org/1014/rss.xml', region: 'üá∫üá∏' },
      ];
      return <NewsCard title="Politics" icon="üèõÔ∏è" feedUrls={feeds} category="politics" limit={7} />;
    }

    // Business News
    function BusinessCard() {
      const feeds = [
        { name: 'Reuters Business', url: 'https://www.reutersagency.com/feed/?best-topics=business-finance&post_type=best' },
        { name: 'CNBC', url: 'https://www.cnbc.com/id/100003114/device/rss/rss.html' },
        { name: 'Bloomberg', url: 'https://feeds.bloomberg.com/markets/news.rss' },
        { name: 'Financial Times', url: 'https://www.ft.com/rss/home' },
      ];
      return <NewsCard title="Business" icon="üíº" feedUrls={feeds} category="business" limit={6} />;
    }

    // Toronto / Canada News
    function TorontoCard() {
      const feeds = [
        { name: 'Toronto Star', url: 'https://www.thestar.com/search/?f=rss&t=article&c=news/gta*&l=50&s=start_time&sd=desc' },
        { name: 'Globe & Mail', url: 'https://www.theglobeandmail.com/arc/outboundfeeds/rss/category/canada/' },
        { name: 'CBC Toronto', url: 'https://www.cbc.ca/webfeed/rss/rss-canada-toronto', region: 'üá®üá¶' },
        { name: 'BlogTO', url: 'https://www.blogto.com/feed/' },
      ];
      return (
        <div className="toronto-card card news-card" style={{ background: 'linear-gradient(135deg, var(--bg-card), rgba(59, 130, 246, 0.1))', borderColor: 'rgba(59, 130, 246, 0.3)' }}>
          <div className="card-header">
            <span className="card-title"><span className="icon">üçÅ</span> Toronto & Canada</span>
          </div>
          <NewsCardInner feedUrls={feeds} category="toronto" limit={6} />
        </div>
      );
    }

    // Sports Scores Card - Live scores from ESPN
    function SportsCard() {
      const [scores, setScores] = useState({ nhl: [], nba: [], nfl: [], mlb: [] });
      const [loading, setLoading] = useState(true);
      const [activeLeague, setActiveLeague] = useState('nhl');

      // ESPN public scoreboard endpoints
      const leagues = {
        nhl: { name: 'NHL', emoji: 'üèí', url: 'https://site.api.espn.com/apis/site/v2/sports/hockey/nhl/scoreboard' },
        nba: { name: 'NBA', emoji: 'üèÄ', url: 'https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard' },
        nfl: { name: 'NFL', emoji: 'üèà', url: 'https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard' },
        mlb: { name: 'MLB', emoji: '‚öæ', url: 'https://site.api.espn.com/apis/site/v2/sports/baseball/mlb/scoreboard' },
      };

      useEffect(() => {
        async function fetchScores() {
          const newScores = {};
          for (const [key, league] of Object.entries(leagues)) {
            try {
              const res = await fetch(league.url);
              const data = await res.json();
              newScores[key] = (data.events || []).slice(0, 4).map(event => {
                const comp = event.competitions?.[0];
                const homeTeam = comp?.competitors?.find(c => c.homeAway === 'home');
                const awayTeam = comp?.competitors?.find(c => c.homeAway === 'away');
                return {
                  home: homeTeam?.team?.abbreviation || '?',
                  away: awayTeam?.team?.abbreviation || '?',
                  homeScore: homeTeam?.score || '0',
                  awayScore: awayTeam?.score || '0',
                  status: event.status?.type?.shortDetail || '',
                  live: event.status?.type?.state === 'in',
                  id: event.id
                };
              });
            } catch (e) {
              console.warn(`Failed to fetch ${key} scores`);
              newScores[key] = [];
            }
          }
          setScores(newScores);
          setLoading(false);
        }
        fetchScores();
        const interval = setInterval(fetchScores, 60000); // Refresh every minute
        return () => clearInterval(interval);
      }, []);

      const currentScores = scores[activeLeague] || [];

      return (
        <div className="card sports-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">üèÜ</span> Scores</span>
            <a href="https://www.espn.com/scores" target="_blank" rel="noopener noreferrer" className="refresh-btn">‚Üó</a>
          </div>

          {/* League tabs */}
          <div style={{ display: 'flex', gap: '0.25rem', marginBottom: '0.75rem' }}>
            {Object.entries(leagues).map(([key, league]) => (
              <button
                key={key}
                onClick={() => setActiveLeague(key)}
                style={{
                  flex: 1,
                  padding: '0.4rem',
                  background: activeLeague === key ? 'var(--accent-orange)' : 'var(--bg-secondary)',
                  border: 'none',
                  borderRadius: '6px',
                  color: activeLeague === key ? 'white' : 'var(--text-secondary)',
                  cursor: 'pointer',
                  fontSize: '0.75rem',
                  fontWeight: 600,
                  transition: 'all 0.2s'
                }}
              >
                {league.emoji} {league.name}
              </button>
            ))}
          </div>

          {loading ? (
            <div className="loading">Loading</div>
          ) : currentScores.length === 0 ? (
            <div style={{ textAlign: 'center', padding: '1rem', color: 'var(--text-secondary)', fontSize: '0.85rem' }}>
              No games scheduled today
            </div>
          ) : (
            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
              {currentScores.map((game, i) => (
                <div
                  key={game.id || i}
                  style={{
                    display: 'grid',
                    gridTemplateColumns: '1fr auto 1fr',
                    alignItems: 'center',
                    padding: '0.6rem',
                    background: 'var(--bg-secondary)',
                    borderRadius: '8px',
                    gap: '0.5rem'
                  }}
                >
                  <div style={{ textAlign: 'right' }}>
                    <span style={{ fontWeight: 600, fontSize: '0.9rem' }}>{game.away}</span>
                  </div>
                  <div style={{ textAlign: 'center' }}>
                    <div style={{ fontFamily: 'JetBrains Mono', fontWeight: 700, fontSize: '1.1rem' }}>
                      {game.awayScore} - {game.homeScore}
                    </div>
                    <div style={{
                      fontSize: '0.65rem',
                      color: game.live ? 'var(--accent-red)' : 'var(--text-secondary)',
                      fontWeight: game.live ? 600 : 400
                    }}>
                      {game.live && '‚óè '}{game.status}
                    </div>
                  </div>
                  <div style={{ textAlign: 'left' }}>
                    <span style={{ fontWeight: 600, fontSize: '0.9rem' }}>{game.home}</span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Culture / Arts
    function CultureCard() {
      const feeds = [
        { name: 'Pitchfork', url: 'https://pitchfork.com/feed/feed-news/rss' },
        { name: 'NYT Arts', url: 'https://rss.nytimes.com/services/xml/rss/nyt/Arts.xml' },
        { name: 'The Guardian Culture', url: 'https://www.theguardian.com/culture/rss' },
        { name: 'Hyperallergic', url: 'https://hyperallergic.com/feed/' },
      ];
      return <NewsCard title="Culture" icon="üé®" feedUrls={feeds} category="culture" limit={6} />;
    }

    // Deep Cuts - Intellectual
    function DeepCutsCard() {
      const [items, setItems] = useState([]);
      const [loading, setLoading] = useState(true);

      const feeds = [
        { name: 'Aeon', url: 'https://aeon.co/feed.rss', category: 'Philosophy' },
        { name: 'The MIT Press Reader', url: 'https://thereader.mitpress.mit.edu/feed/', category: 'Ideas' },
        { name: 'LitHub', url: 'https://lithub.com/feed/', category: 'Literature' },
        { name: 'The Marginalian', url: 'https://www.themarginalian.org/feed/', category: 'Culture' },
        { name: 'Longreads', url: 'https://longreads.com/feed/', category: 'Essays' },
        { name: 'n+1', url: 'https://www.nplusonemag.com/feed/', category: 'Criticism' },
      ];

      useEffect(() => {
        async function load() {
          const allItems = [];
          for (const feed of feeds) {
            try {
              const rssItems = await fetchRSS(feed.url);
              rssItems.slice(0, 2).forEach(item => {
                allItems.push({
                  ...item,
                  category: feed.category,
                  source: feed.name
                });
              });
            } catch (e) {
              console.warn(`Failed: ${feed.name}`);
            }
          }
          // Shuffle for variety
          allItems.sort(() => Math.random() - 0.5);
          setItems(allItems.slice(0, 5));
          setLoading(false);
        }
        load();
      }, []);

      // Strip HTML from description
      const stripHtml = (html) => {
        const tmp = document.createElement('div');
        tmp.innerHTML = html;
        return tmp.textContent || tmp.innerText || '';
      };

      return (
        <div className="card deep-cuts-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">üé≠</span> Deep Cuts</span>
          </div>
          {loading ? (
            <div className="loading">Loading</div>
          ) : (
            items.map((item, i) => (
              <a key={i} className="deep-cut-item" href={item.link} target="_blank" rel="noopener noreferrer">
                <div className="deep-cut-category">{item.category} ¬∑ {item.source}</div>
                <div className="deep-cut-title">{item.title}</div>
                <div className="deep-cut-desc">{stripHtml(item.description).slice(0, 120)}...</div>
              </a>
            ))
          )}
        </div>
      );
    }

    // Transit Card - 28th & 3rd Ave, Manhattan
    function TransitCard() {
      const [time, setTime] = useState(new Date());
      const [alerts, setAlerts] = useState([]);

      // Walking times from 28th & 3rd Ave
      const WALK_TO_SUBWAY = 5; // 28th St station (Park Ave) ~5 min
      const WALK_TO_BUS = 7;    // 34th St (M34 stops) ~7 min

      // Typical frequencies (minutes between trains/buses)
      const frequencies = {
        rush: { subway: 4, bus: 8 },      // 7-9am, 5-7pm weekdays
        midday: { subway: 6, bus: 10 },   // 9am-5pm weekdays
        evening: { subway: 8, bus: 12 },  // 7-10pm
        night: { subway: 10, bus: 15 },   // 10pm-7am
        weekend: { subway: 8, bus: 12 }
      };

      useEffect(() => {
        const timer = setInterval(() => setTime(new Date()), 30000); // Update every 30s
        return () => clearInterval(timer);
      }, []);

      // Fetch MTA service alerts
      useEffect(() => {
        async function fetchAlerts() {
          try {
            // MTA Service Status RSS
            const items = await fetchRSS('https://api.mta.info/alert/rss/LineStatus.xml');
            const relevantAlerts = items.filter(item =>
              item.title.includes('6') ||
              item.title.includes('M34') ||
              item.title.toLowerCase().includes('lexington')
            ).slice(0, 2);
            setAlerts(relevantAlerts);
          } catch (e) {
            console.warn('Could not fetch MTA alerts');
          }
        }
        fetchAlerts();
        const interval = setInterval(fetchAlerts, 5 * 60 * 1000);
        return () => clearInterval(interval);
      }, []);

      const getTimeOfDay = () => {
        const hour = time.getHours();
        const day = time.getDay();
        const isWeekend = day === 0 || day === 6;

        if (isWeekend) return 'weekend';
        if (hour >= 7 && hour < 9) return 'rush';
        if (hour >= 17 && hour < 19) return 'rush';
        if (hour >= 9 && hour < 17) return 'midday';
        if (hour >= 19 && hour < 22) return 'evening';
        return 'night';
      };

      const getCurrentFrequency = () => frequencies[getTimeOfDay()];

      // Calculate next departures based on typical frequencies
      const getNextDepartures = (freq, walkTime) => {
        const now = time.getMinutes() + (time.getSeconds() / 60);
        const departures = [];

        // Generate next 3 approximate departures
        for (let i = 0; i < 3; i++) {
          const minsFromNow = Math.floor(Math.random() * freq) + (i * freq);
          departures.push(minsFromNow);
        }

        return departures.sort((a, b) => a - b);
      };

      const subwayFreq = getCurrentFrequency().subway;
      const busFreq = getCurrentFrequency().bus;

      const subwayDepartures = getNextDepartures(subwayFreq, WALK_TO_SUBWAY);
      const busDepartures = getNextDepartures(busFreq, WALK_TO_BUS);

      const formatDeparture = (mins) => {
        if (mins < 1) return 'Now';
        if (mins === 1) return '1 min';
        return `${mins} min`;
      };

      const getLeaveBy = (nextDeparture, walkTime) => {
        const buffer = 2; // 2 min buffer
        const leaveIn = nextDeparture - walkTime - buffer;

        if (leaveIn <= 0) {
          return { text: 'Leave now!', urgent: true };
        } else if (leaveIn <= 3) {
          return { text: `Leave in ${leaveIn} min`, urgent: true };
        } else {
          const leaveTime = new Date(time.getTime() + leaveIn * 60000);
          return {
            text: `Leave by ${leaveTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}`,
            urgent: false
          };
        }
      };

      const subwayLeave = getLeaveBy(subwayDepartures[0], WALK_TO_SUBWAY);
      const busLeave = getLeaveBy(busDepartures[0], WALK_TO_BUS);

      return (
        <div className="card transit-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">üöá</span> Transit</span>
            <a
              href="https://new.mta.info/"
              target="_blank"
              rel="noopener noreferrer"
              className="refresh-btn"
              title="MTA Live"
            >‚Üó</a>
          </div>

          {/* 6 Train */}
          <div className="transit-route">
            <div className="route-badge subway-6">6</div>
            <div className="route-info">
              <div className="route-name">Lexington Ave Local</div>
              <div className="route-destination">28th St ‚Üí Uptown / Downtown</div>
            </div>
            <div className="route-times">
              <div className="next-departure">~{formatDeparture(subwayDepartures[0])}</div>
              <div className={`leave-by ${subwayLeave.urgent ? 'leave-now' : ''}`}>
                {subwayLeave.text}
              </div>
            </div>
          </div>

          {/* M34 Bus */}
          <div className="transit-route">
            <div className="route-badge bus">M34</div>
            <div className="route-info">
              <div className="route-name">34th St Crosstown</div>
              <div className="route-destination">To Hudson Yards / FDR</div>
            </div>
            <div className="route-times">
              <div className="next-departure">~{formatDeparture(busDepartures[0])}</div>
              <div className={`leave-by ${busLeave.urgent ? 'leave-now' : ''}`}>
                {busLeave.text}
              </div>
            </div>
          </div>

          {/* M34A SBS */}
          <div className="transit-route">
            <div className="route-badge bus">M34A</div>
            <div className="route-info">
              <div className="route-name">34th St Select Bus</div>
              <div className="route-destination">To Javits / Waterside</div>
            </div>
            <div className="route-times">
              <div className="next-departure">~{formatDeparture(busDepartures[1])}</div>
              <div className="leave-by">Every ~{busFreq} min</div>
            </div>
          </div>

          {/* Service Alerts */}
          {alerts.length > 0 && (
            <div className="transit-alert">
              <span className="transit-alert-icon">‚ö†Ô∏è</span>
              <span className="transit-alert-text">
                {alerts[0].title.slice(0, 100)}...
              </span>
            </div>
          )}

          {/* Quick Links */}
          <div className="transit-links">
            <a
              href="https://bustime.mta.info/m/index?q=M34"
              target="_blank"
              rel="noopener noreferrer"
              className="transit-link"
            >
              üöå Live Bus Times
            </a>
            <a
              href="https://new.mta.info/maps/subway-line-maps"
              target="_blank"
              rel="noopener noreferrer"
              className="transit-link"
            >
              üó∫Ô∏è Subway Map
            </a>
          </div>

          <div className="walking-info">
            üö∂ 5 min to 28th St station ¬∑ 7 min to 34th St bus stops
          </div>
        </div>
      );
    }

    // Inner news component for Toronto card
    function NewsCardInner({ feedUrls, category, limit = 6 }) {
      const [news, setNews] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        async function load() {
          const allItems = [];
          for (const feed of feedUrls) {
            try {
              const items = await fetchRSS(feed.url);
              items.forEach(item => {
                allItems.push({ ...item, sourceName: feed.name, region: feed.region || '' });
              });
            } catch (e) {
              console.warn(`Failed: ${feed.name}`);
            }
          }
          allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
          setNews(allItems.slice(0, limit));
          setLoading(false);
        }
        load();
      }, []);

      if (loading) return <div className="loading">Loading</div>;

      return (
        <div className="news-list">
          {news.map((item, i) => (
            <a key={i} className="news-item" href={item.link} target="_blank" rel="noopener noreferrer">
              <div className={`news-source ${category}`}>
                {item.region && `${item.region} `}{item.sourceName}
              </div>
              <div className="news-headline">{item.title}</div>
              <div className="news-time">{timeAgo(item.pubDate)}</div>
            </a>
          ))}
        </div>
      );
    }

    // Stock data using Finnhub public API (free, no key needed for basic quotes)
    function StocksCard() {
      const [stocks, setStocks] = useState([]);
      const [loading, setLoading] = useState(true);

      const stockList = [
        { symbol: 'SPY', name: 'S&P 500' },
        { symbol: 'QQQ', name: 'Nasdaq 100' },
        { symbol: 'AAPL', name: 'Apple' },
        { symbol: 'MSFT', name: 'Microsoft' },
        { symbol: 'GOOGL', name: 'Alphabet' },
        { symbol: 'NVDA', name: 'NVIDIA' },
        { symbol: 'TSLA', name: 'Tesla' },
        { symbol: 'AMZN', name: 'Amazon' },
      ];

      useEffect(() => {
        async function fetchStocks() {
          try {
            // Try using a CORS proxy with Yahoo Finance
            const symbols = stockList.map(s => s.symbol).join(',');
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbols}`)}`;
            const res = await fetch(proxyUrl);
            const data = await res.json();

            if (data.quoteResponse?.result) {
              const results = data.quoteResponse.result.map(q => {
                const stockInfo = stockList.find(s => s.symbol === q.symbol);
                return {
                  symbol: q.symbol,
                  name: stockInfo?.name || q.shortName,
                  price: q.regularMarketPrice?.toFixed(2) || '---',
                  change: q.regularMarketChangePercent?.toFixed(2) || 0
                };
              });
              setStocks(results);
            } else {
              throw new Error('No data');
            }
          } catch (e) {
            console.warn('Stock fetch failed, using fallback:', e);
            // Use market data API as fallback - show links instead
            setStocks(stockList.map(s => ({
              ...s,
              price: '---',
              change: 0
            })));
          }
          setLoading(false);
        }
        fetchStocks();
        const interval = setInterval(fetchStocks, 2 * 60 * 1000); // Refresh every 2 min
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="card stocks-card">
          <div className="card-header">
            <span className="card-title"><span className="icon">üìà</span> Markets</span>
            <a href="https://finance.yahoo.com" target="_blank" rel="noopener noreferrer" className="refresh-btn" title="Open Yahoo Finance">‚Üó</a>
          </div>
          {loading ? (
            <div className="loading">Loading</div>
          ) : (
            <div className="stock-list">
              {stocks.map(stock => (
                <a
                  key={stock.symbol}
                  href={`https://finance.yahoo.com/quote/${stock.symbol}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="stock-item"
                  style={{ textDecoration: 'none', color: 'inherit' }}
                >
                  <div>
                    <div className="stock-symbol">{stock.symbol}</div>
                    <div className="stock-name">{stock.name}</div>
                  </div>
                  <div className="stock-price">
                    <div className="stock-value">{stock.price !== '---' ? `$${stock.price}` : '---'}</div>
                    <div className={`stock-change ${parseFloat(stock.change) >= 0 ? 'up' : 'down'}`}>
                      {stock.price !== '---' ? (
                        <>{parseFloat(stock.change) >= 0 ? '‚ñ≤' : '‚ñº'} {Math.abs(stock.change)}%</>
                      ) : (
                        'Click for quote'
                      )}
                    </div>
                  </div>
                </a>
              ))}
            </div>
          )}
        </div>
      );
    }

    // Stock Ticker Bar
    function TickerBar() {
      const [items, setItems] = useState([]);

      const symbols = ['SPY', 'QQQ', 'DIA', 'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'TSLA', 'META', 'BTC-USD', 'ETH-USD'];

      useEffect(() => {
        async function fetchData() {
          try {
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(`https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbols.join(',')}`)}`;
            const res = await window.fetch(proxyUrl);
            const data = await res.json();
            if (data.quoteResponse?.result) {
              setItems(data.quoteResponse.result.map(q => ({
                symbol: q.symbol.replace('-USD', ''),
                price: q.regularMarketPrice?.toFixed(2) || '---',
                change: q.regularMarketChangePercent?.toFixed(2) || 0
              })));
            } else {
              throw new Error('No data');
            }
          } catch (e) {
            // Fallback with placeholder data
            setItems(symbols.map(s => ({ symbol: s.replace('-USD', ''), price: '---', change: 0 })));
          }
        }
        fetchData();
        const interval = setInterval(fetchData, 2 * 60 * 1000);
        return () => clearInterval(interval);
      }, []);

      if (items.length === 0) {
        return (
          <div className="ticker-container">
            <div style={{ padding: '0.5rem', textAlign: 'center', color: 'var(--text-secondary)', fontSize: '0.85rem' }}>
              Loading market data...
            </div>
          </div>
        );
      }

      const doubled = [...items, ...items];

      return (
        <div className="ticker-container">
          <div className="ticker">
            {doubled.map((item, i) => (
              <span key={i} className="ticker-item">
                <span className="symbol">{item.symbol}</span>
                <span>{item.price !== '---' ? `$${item.price}` : '---'}</span>
                {item.price !== '---' && (
                  <span className={`change ${parseFloat(item.change) >= 0 ? 'up' : 'down'}`}>
                    {parseFloat(item.change) >= 0 ? '‚ñ≤' : '‚ñº'} {Math.abs(item.change)}%
                  </span>
                )}
              </span>
            ))}
          </div>
        </div>
      );
    }

    // Main App
    function App() {
      const [time, setTime] = useState(new Date());

      useEffect(() => {
        const timer = setInterval(() => setTime(new Date()), 1000);
        return () => clearInterval(timer);
      }, []);

      const formatDate = (d) => d.toLocaleDateString('en-US', {
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
      });

      const greeting = time.getHours() < 12 ? 'morning' : time.getHours() < 18 ? 'afternoon' : 'evening';

      return (
        <div className="dashboard">
          <header className="header">
            <h1>Good {greeting}, Rafi</h1>
            <div className="header-time">
              <div className="time">
                {time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
              </div>
              <div className="date">{formatDate(time)}</div>
            </div>
          </header>

          <div className="grid">
            <TickerBar />

            <div className="weather-grid">
              <WeatherCard city="New York" lat={40.7128} lon={-74.006} timezone="America/New_York" />
              <WeatherCard city="Toronto" lat={43.6532} lon={-79.3832} timezone="America/Toronto" />
              <WeatherCard city="Tel Aviv" lat={32.0853} lon={34.7818} timezone="Asia/Jerusalem" />
            </div>

            <StocksCard />

            <TransitCard />
            <SportsCard />
            <TorontoCard />
            <PoliticsCard />
            <BusinessCard />
            <CultureCard />
            <DeepCutsCard />
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
